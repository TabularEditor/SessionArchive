{
  "name": "Sales Target QTD",
  "expression": [
    "",
    "VAR _QTD =",
    "    CALCULATE(",
    "        [Sales Target],",
    "        CALCULATETABLE(",
    "            DATESQTD( 'Date'[Date] ),",
    "            'Date'[IsDateInScope] = TRUE",
    "        ),",
    "        'Date'[IsThisMonth] = FALSE",
    "    )",
    "VAR _MTD =",
    "    CALCULATE( [Sales Target MTD], 'Date'[IsThisMonth] = TRUE )",
    "VAR _PERIOD = SELECTEDVALUE( '4) Selected Period'[Period] )",
    "VAR _QUARTER = MAX( 'Date'[Calendar Year Quarter (ie 202101)] )",
    "VAR _MONTH = MAX( 'Date'[Calendar Year Month (ie 202101)] )",
    "RETURN",
    "    IF(",
    "        _PERIOD = \"Full Period\",",
    "        CALCULATE(",
    "            [Sales Target],",
    "            ALL( 'Date' ),",
    "            'Date'[Calendar Year Quarter (ie 202101)] = _QUARTER,",
    "            'Date'[Calendar Year Month (ie 202101)] <= _MONTH",
    "        ),",
    "        IF(",
    "            ISBLANK( _QTD ),",
    "            _MTD,",
    "            // If date is in the visual context and QTD is blank, show MTD, otherwise add QTD + MTD together",
    "            IF( MAX ( 'Date'[Date] ) >= MAX ('Last Refresh'[Last Refresh]), _QTD + _MTD, _QTD )",
    "        )",
    "    )"
  ],
  "formatString": "#,##0",
  "displayFolder": "3. QTD\\Sales Target",
  "lineageTag": "5e01dd13-583d-429c-9ba4-79b2fc89b918"
}