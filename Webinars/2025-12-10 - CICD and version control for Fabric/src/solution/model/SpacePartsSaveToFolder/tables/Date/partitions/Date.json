{
  "name": "Date",
  "mode": "import",
  "source": {
    "type": "calculated",
    "expression": [
      "",
      "-- Reference date for the latest date in the report",
      "-- Until when the business wants to see data in reports",
      "VAR _Refdate_Measure = [RefDate]",
      "VAR _Today = TODAY ( )",
      "",
      "-- Replace with \"Today\" if [RefDate] evaluates blank",
      "VAR _Refdate = IF ( ISBLANK ( _Refdate_Measure ), _Today, _Refdate_Measure )",
      "    VAR _RefYear        = YEAR ( _Refdate )",
      "    VAR _RefQuarter     = _RefYear * 100 + QUARTER(_Refdate)",
      "    VAR _RefMonth       = _RefYear * 100 + MONTH(_Refdate)",
      "    VAR _RefWeek_EU     = _RefYear * 100 + WEEKNUM(_Refdate, 2)",
      " ",
      "-- Earliest date in the model scope",
      "VAR _EarliestDate       = DATE ( YEAR ( MIN ( 'Orders'[Order Date] ) ) - 2, 1, 1 )",
      "VAR _EarliestDate_Safe  = MIN ( _EarliestDate, DATE ( YEAR ( _Today ) + 1, 1, 1 ) )",
      "",
      "-- Latest date in the model scope",
      "VAR _LatestDate_Safe    = DATE ( YEAR ( _Refdate ) + 2, 12, 1 )",
      "",
      "------------------------------------------",
      "-- Base calendar table",
      "VAR _Base_Calendar      = CALENDAR ( _EarliestDate_Safe, _LatestDate_Safe )",
      "------------------------------------------",
      "",
      "",
      "",
      "------------------------------------------",
      "VAR _IntermediateResult = ",
      "    ADDCOLUMNS ( _Base_Calendar,",
      "",
      "            ------------------------------------------",
      "        \"Calendar Year Number (ie 2021)\",           --|",
      "            YEAR ([Date]),                          --|-- Year",
      "                                                    --|",
      "        \"Calendar Year (ie 2021)\",                  --|",
      "            FORMAT ([Date], \"YYYY\"),                --|",
      "            ------------------------------------------",
      "",
      "            ------------------------------------------",
      "        \"Calendar Quarter Year (ie Q1 2021)\",       --|",
      "            \"Q\" &                                   --|-- Quarter",
      "            CONVERT(QUARTER([Date]), STRING) &      --|",
      "            \" \" &                                   --|",
      "            CONVERT(YEAR([Date]), STRING),          --|",
      "                                                    --|",
      "        \"Calendar Year Quarter (ie 202101)\",        --|",
      "            YEAR([Date]) * 100 + QUARTER([Date]),   --|",
      "                                                    --| ",
      "        \"Calendar Quarter (ie Q1)\",                 --|",
      "            \"Q\" &                                   --|",
      "            CONVERT(QUARTER([Date]), STRING),       --|  ",
      "            ------------------------------------------",
      "",
      "            ------------------------------------------",
      "        \"Calendar Month Year (ie Jan 21)\",          --|",
      "            FORMAT ( [Date], \"MMM YY\" ),            --|-- Month",
      "                                                    --|",
      "        \"Calendar Year Month (ie 202101)\",          --|",
      "            YEAR([Date]) * 100 + MONTH([Date]),     --|",
      "                                                    --|",
      "        \"Calendar Month (ie Jan)\",                  --|",
      "            FORMAT ( [Date], \"MMM\" ),               --|",
      "                                                    --|",
      "        \"Calendar Month # (ie 1)\",                  --|",
      "            MONTH ( [Date] ),                       --|",
      "            ------------------------------------------",
      "            ",
      "            ------------------------------------------",
      "        \"Calendar Week EU (ie WK25)\",               --|",
      "            \"WK\" & WEEKNUM( [Date], 2 ),            --|-- Week",
      "                                                    --|",
      "        \"Calendar Week Number EU (ie 25)\",          --|",
      "            WEEKNUM( [Date], 2 ),                   --|",
      "                                                    --|",
      "        \"Calendar Year Week Number EU (ie 202125)\", --|",
      "            YEAR ( [Date] ) * 100                   --|",
      "            +                                       --|",
      "            WEEKNUM( [Date], 2 ),                   --|",
      "                                                    --|",
      "        \"Calendar Week US (ie WK25)\",               --|",
      "            \"WK\" & WEEKNUM( [Date], 1 ),            --|",
      "                                                    --|",
      "        \"Calendar Week Number US (ie 25)\",          --|",
      "            WEEKNUM( [Date], 1 ),                   --|",
      "                                                    --|",
      "        \"Calendar Year Week Number US (ie 202125)\", --|",
      "            YEAR ( [Date] ) * 100                   --|",
      "            +                                       --|",
      "            WEEKNUM( [Date], 1 ),                   --|",
      "                                                    --|",
      "        \"Calendar Week ISO (ie WK25)\",              --|",
      "            \"WK\" & WEEKNUM( [Date], 21 ),           --|",
      "                                                    --|",
      "        \"Calendar Week Number ISO (ie 25)\",         --|",
      "            WEEKNUM( [Date], 21 ),                  --|",
      "                                                    --|",
      "        \"Calendar Year Week Number ISO (ie 202125)\",--|",
      "            YEAR ( [Date] ) * 100                   --|",
      "            +                                       --|",
      "            WEEKNUM( [Date], 21 ),                  --|",
      "            ------------------------------------------",
      "",
      "            ------------------------------------------",
      "        \"Weekday Short (i.e. Mon)\",                 --|",
      "            FORMAT ( [Date], \"DDD\" ),               --|-- Weekday",
      "                                                    --|",
      "        \"Weekday Name (i.e. Monday)\",               --|",
      "            FORMAT ( [Date], \"DDDD\" ),              --|",
      "                                                    --|",
      "        \"Weekday Number EU (i.e. 1)\",               --|",
      "            WEEKDAY ( [Date], 2 ),                  --|",
      "            ------------------------------------------",
      "            ",
      "            ------------------------------------------",
      "        \"Calendar Month Day (i.e. Jan 05)\",         --|",
      "            FORMAT ( [Date], \"MMM DD\" ),            --|-- Day",
      "                                                    --|",
      "        \"Calendar Month Day (i.e. 0105)\",           --|",
      "            MONTH([Date]) * 100                     --|",
      "            +                                       --|",
      "            DAY([Date]),                            --|",
      "                                                    --|",
      "        \"YYYYMMDD\",                                 --|",
      "            YEAR ( [Date] ) * 10000                 --|",
      "            +                                       --|",
      "            MONTH ( [Date] ) * 100                  --|",
      "            +                                       --|",
      "            DAY ( [Date] ),                         --|",
      "            ------------------------------------------",
      "",
      "",
      "            ------------------------------------------",
      "        \"IsDateInScope\",                            --|",
      "            [Date] <= _Refdate                      --|-- Boolean",
      "            &&                                      --|",
      "            YEAR([Date]) > YEAR(_EarliestDate),     --|",
      "                                                    --|",
      "        \"IsBeforeThisMonth\",                        --|",
      "            [Date] <= EOMONTH ( _Refdate, -1 ),     --|",
      "                                                    --|",
      "        \"IsLastMonth\",                              --|",
      "            [Date] <= EOMONTH ( _Refdate, 0 )       --|",
      "            &&                                      --|",
      "            [Date] > EOMONTH ( _Refdate, -1 ),      --|",
      "                                                    --|",
      "        \"IsYTD\",                                    --|",
      "            MONTH([Date])                           --|",
      "            <=                                      --|",
      "            MONTH(EOMONTH ( _Refdate, 0 )),         --|",
      "                                                    --|",
      "        \"IsActualToday\",                            --|",
      "            [Date] = _Today,                        --|",
      "                                                    --|",
      "        \"IsRefDate\",                                --|",
      "            [Date] = _Refdate,                      --|",
      "                                                    --|",
      "        \"IsHoliday\",                                --|",
      "            MONTH([Date]) * 100                     --|",
      "            +                                       --|",
      "            DAY([Date])                             --|",
      "                IN {0101, 0501, 1111, 1225},        --|",
      "                                                    --|",
      "        \"IsWeekday\",                                --|",
      "            WEEKDAY([Date], 2)                      --|",
      "                IN {1, 2, 3, 4, 5})                 --|",
      "            ------------------------------------------",
      "",
      "VAR _Result = ",
      "    ",
      "            --------------------------------------------",
      "    ADDCOLUMNS (                                      --|",
      "        _IntermediateResult,                          --|-- Boolean #2",
      "        \"IsThisYear\",                                 --|",
      "            [Calendar Year Number (ie 2021)]          --|",
      "                = _RefYear,                           --|",
      "                                                      --|",
      "        \"IsThisMonth\",                                --|",
      "            [Calendar Year Month (ie 202101)]         --|",
      "                = _RefMonth,                          --|",
      "                                                      --|",
      "        \"IsThisQuarter\",                              --|",
      "            [Calendar Year Quarter (ie 202101)]       --|",
      "                = _RefQuarter,                        --|",
      "                                                      --|",
      "        \"IsThisWeek\",                                 --|",
      "            [Calendar Year Week Number EU (ie 202125)]--|",
      "                = _RefWeek_EU                         --|",
      "    )                                                 --|",
      "            --------------------------------------------",
      "            ",
      "RETURN ",
      "    _Result"
    ]
  }
}